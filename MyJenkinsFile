pipeline{
  agent any
  stages{
    stage('Code Clone'){
      steps{
        echo "cloning code from repository"
        git branch: 'main', url: 'https://github.com/bHARATHaALETI018/django-notes-app.git'
        sh 'pwd && ls -lart'
        echo "code cloned successfully"
      }
    }
    // stage('Build'){
    //   steps{
    //     echo "building the code"
    //     sh 'whoami'
    //     sh 'docker build -t django-notes-app:latest .'
    //     echo "code built successfully"
    //   }
    // }
    // stage('Test'){
    //   steps{
    //     echo "testing the build"
    //     sh 'docker run -d -p 8000:8000 --name django-notes-app-test django-notes-app:latest'
    //     echo "code tested successfully"
    //   }
    // }  
    stage('Deploy'){
      steps{
        echo "deploying the build"
        sh 'whoami'
        sh 'docker compose down . && docker compose up -d .'
        sh 'docker ps'
        sh 'sleep 180'
        sh 'docker compose down . '
        sh 'docker ps && docker ps -a'
        echo "code deployed successfully"
      }
    }
  }
  post {
        success {
            echo "✅ Pipeline completed successfully!"
        }
        failure {
            echo "❌ Pipeline failed."
        }
    }
}
